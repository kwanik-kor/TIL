> 이더넷과 무선 LAN 그리고 레이어2 스위치로 같은 네트워크 안에서 데이터를 전송할 수 있음을 알게 되었다. 그럼 네트워크에서 다른 네트워크로 전송을 할 때는 어떻게 해야 할까?

# 6.1 외부 네트워크로 데이터를 보낸다
> 라우터는 데이터의 목적지가 어느 네트워크에 접속해 있는지 판단해서, 연결된 네트워크의 라우터로 전송한다.

- 반복된 라우팅을 통해서 외부 네트워크로 데이터를 전송

**운반하는 데이터는 IP 패킷**
- 라우터는 IP 패킷을 전송
- 라우팅 동작은 인터넷층에서 동작
	- IP 패킷이 TCP/IP 계층에서 인터넷층이므로
- IP 헤더 내의 목적지 IP 주소 확인
	- IP 헤더의 TTL과 헤더 체크섬만 변경
		- 나머지는 변경하지 않은 채로 전송
		- NAT 주소 변환이 이루어지는 경우 IP 주소도 변경됨
	- 이더넷 헤서와 FCS는 라우터가 전송할 때 완전히 교체
		- 연결된 네트워크에 있는 다른 라우터까지 보내기 위한 것이기 때문

# 6.2 라우터에서 네트워크 연결에 필요한 주소 설정
> 네트워크에 접속한다는 것 = IP 주소 설정
> 라우터로 복수의 네트워크를 연결할 때도 IP 주소를 설정함

**네트워크 연결**
- 라우터 인터페이스의 물리적 배선에 더해 IP 주소를 설정해야 함
- 각 인터페이스에 IP 주소를 설정하여 각 네트워크에 연결
	- 192.168.1.254/24로 설정할 경우, 192.168.1.0/24 네트워크에 접속할 수 있게 됨

# 6.3 데이터의 전송처를 결정한다

- 라우팅 대상인 IP 패킷을 수신한다.
	- IP 패킷 수신
		- 목적지 레이어2 주소(MAC 주소): 라우터
		- 목적지 IP 주소: 라우터의 IP 주소 이외
- 경로 정보를 검색해서 전송할 곳을 결정한다.
	- 라우팅 테이블 상의 경로 정보 검색 후 전송할 곳 결정
	- 넥스트 홉(다음에 전송할 라우터) 파악
	- 레이어2 헤더 수정, IP 패킷 전송

# 6.4 다음 라우터로 데이터를 전송한다

- 넥스트 홉에 데이터를 전송하기 위해서는 넥스트 홉의 MAC 주소가 필요
- ARP 실행
	- IP 주소로 MAC 주소 구하는 프로토콜
- 새로운 이더넷 헤더로 변경, FCS 새로 추가
- IP 헤더 변경
	- IP 주소는 그대로
		- NAT로 IP 로 주소를 변환할 때는 변경됨
	- TTL -1 처리, 헤더 체크섬 재계산

# 6.5 최종 주소를 확인한다

- 넥스트 홉에서도 동일하게 라우팅 처리 수행
- 라우팅 테이블에서 일치하는 IP 주소 탐색 후, 직접 접속되어 있는 호스트인 경우 같은 네트워크에 있음을 알 수 있게 됨

# 6.6 최종 목적지로 데이터를 보낸다

- 라우팅 테이블에서 최종 목적지를 확인한 경우, 해당 호스트로 IP 패킷을 전송하기 위해 호스트의 MAC 주소가 필요함
	- ARP 실행
- ARP로 MAC 주소를 확인후에 새로운 이더넷 헤더 추가하여 IP 패킷 전송
- 데이터를 받으면 반환함

# 6.7 라우터가 인식하는 네트워크 정보

**라우팅 테이블**
- 어떤 네트워크로 IP 패킷을 전송하기 위한 경로가 등록되어 있음
	- 경로란 다음에 전송해야 하는 라우터
- 루트 정보 / 경로 정보
	- 라우팅 테이블에 등록된 네트워크 정보
- 이웃 라우터의 네트워크 구성 인식
	- 자신을 중심으로 이웃 랑우터 저 너머에 어떤 네트워크가 있는가 하는 수준
	- 인식할 수 없는 네트워크로 가는 IP 패킷은 모두 폐기

# 6.8 라우팅 테이블의 가장 기본적인 정보

**라우팅 테이블을 만드는 방법**
- 직접 접속
- 스태틱 라우팅
- 라우팅 프로토콜

**직접 접속**
- 가장 기본적인 경로 정보
- 라우터가 직접 연결된 네트워크의 경로 정보
- 직접 접속의 경로를 라우팅 테이블에 등록하기 위한 특별한 설정은 필요 없음
- IP 주소 설정, 인터페이스 활성화하면 끝
- 라우터는 직접 접속된 네트워크밖에 모름

# 6.9 직접 접속되지 않은 경로 정보를 등록하는 방법

> 직접 접속 경로 정보에 더해, 라우터에 직접 접속되지 않은 원격 네트워크의 경로정보를 직접 등록해야 함

**스태틱 라우팅(static routing)**
- 라우터에 커맨드를 입력하는 등 경로 정보를 수동으로 라우팅 테이블에 등록하는 방법
- 네트워크 주소/서브넷 마스크와 넥스트 홉 주소를 커맨드로 입력해서 등록

- 라우터끼리 정보를 교환해 라우팅 테이블에 필요한 경로 정보 등록
	- RIP(Routing Information Protocol)
		- 주로 소규모 네트워크에서 이용
	- OSPF(Open Shortest Path First)
		- 중~대규모 네트워크에도 대응
	- BGP(Border Gateway Protocol)
		- 주로 인터넷 백본에서 이용

# 6.10 방대한 경로 정보를 모아서 등록하는 방법
> 모든 네트워크의 경로 정보를 라우팅 테이블에 등록하기는 어려움

- 라우팅 동작은 넥스트 홉(이웃 라우터)까지만 보내면 됨
	- 네트워크 홉이 똑같은 네트워크를 일일이 등록하는 것은 의미가 없음
- 경로 요약
	- 넥스트 홉이 공통인 원격 네트워크의 경로 정보를 하나로 모아 등록
	- 요약 시, 설정하는 항목을 줄일 수 있음

# 6.11 경로 정보를 최대한으로 줄이는 방법

**디폴트 경로**
- 0.0.0.0/0
- 모든 네트워크를 집약
- 디폴트 경로를 등록할 경우 모든 네트워크의 경로 정보를 등록한 것
- 인터넷의 방대한 네트워크 주소를 집약해서 디폴트 경로를 라우팅 테이블에 등록

# 6.12 라우터와 레이어2 스위치의 기능을 가진 데이터 전송 기기

**레이어3 스위치**
- 레이어2 스위치에 라우터 기능을 추가한 네트워크 기기
- 레이어2 스위치처럼 데이터 전송도 할 수 있고, 라우터처럼 데이터 전송도 할 수 있음
- 많은 이더넷 인터페이스를 갖춘 네트워크 기기
- 같은 네트워크로 전송할 때는 레이어2 스위치처럼 MAC 주소 기반 전송
- 다른 네트워크로 전송할 때는 라우터처럼 IP 주소를 기반으로 전송
- 여러 네트워크를 연결하기 위해 VLAN(Virtual LAN) 기능을 이용

# 6.13 레이어2 스위치로 네트워크를 분할한다

**VLAN(Virtual LAN)**
- 레이어2 스위치에서 네트워크를 복수로 분할할 수 있게 하는 것
	- 하나의 네트워크에 수많은 기기를 연결하면 불필요한 데이터 전송이 많아짐
- 레이어2 스위치는 모든 포트 사이에서 이더넷 프레임을 전송할 수 있음
- 이를 VLAN으로 나눠 같은 VLAN에 할당한 포트끼리만 이더넷 프레임을 전송하도록 함
	- VLAN10 - 포트1, 포트2
	- VLAN20 - 포트3, 포트4
	- 각각의 VLAN내에서는 할당된 포트만 이더넷 프레임을 전송할 수 있게 됨

# 6.14 VLAN을 사용하는 이유

- 레이어2 스위치를 가상으로 분할하여, 네트워크를 분할하여 VLAN 간의 데이터를 분리하게 됨
- 보안 향상
	- 데이터가 전송되는 범위를 제한할 수 있으므로
- 네트워크를 분할하기만 함
	- VLAN으로 분할한 네트워크가 통신하기 위해서는 라우터와 레이어3 스위치가 필요

# 6.15 복수의 접속선을 한 줄로 깔끔하게 정리한다

**복수의 스위치로 VLAN을 만든다**
- VLAN은 복수의 스위치에 걸쳐서 만들 수 있음
- 스위치 간의 연결이 VLAN 마다 필요함
	- VLAN이 두 개 있는 경우, 스위치 사이를 두 줄로 연결해야 함
	- 이를 효율적으로 연결하기 위해 태그 VLAN(트렁크) 포트가 있음

**태그 VLAN**
- 태그 VLAN 포트를 이용해 복수의 레이어2 스위치로 VLAN 구성 시, 레이어2 스위치 간의 접속을 한 줄로 해결할 수 있음
- 복수의 VLAN 이더넷 프레임을 전송할 수 있는 포트
- 태그 VLAN 포트로 송수신하는 이더넷 프레임에는 VLAN 태그 추가
	- VLAN 태그로 VLAN을 식별
		- TPID
		- TCI
			- Priority(3 bit)
			- CFI(1 bit)
			- VLAN 번호(12 bit)
- IEEE802.1Q

# 6.16 기기 추가나 배선을 변경하지 않고 네트워크를 바꾼다
> 레이어2 스위치로 두 개의 VLAN을 만들면 태그 VLAN 포트는 두 개의 VLAN 포트로서 분할하여 사용할 수 있음

VLAN
- 레이어2 스위치를 가상으로 분할

태그 VLAN
- 포트를 VLAN 별로 가상으로 분할

- 레이어2 스위치에서 만든 VLAN은 설정으로 자유롭게 결정할 수 있음
	- 어느 포트를 어느 VLAN에 할당할지
	- 태그 VLAN 포트 등

# 6.17 분할한 네트워크끼리 연결하는 방법

**VLAN 라우팅**
- VLAN은 네트워크를 분할하기만 하므로, VLAN간 통신을 위해서는 VLAN을 연결해야 함
- 이를 위해서는 라우터 또는 레이어3 스위치가 필요
- IP 주소 설정
	- 레이어3 스위치 내부의 가상 인터페이스(VLAN 인터페이스)에 IP 주소 설정
	- 레이어3 스위치의 포트 자체에 IP 주소 설정

# 6.18 PC에도 라우팅 테이블이 있다
> 라우팅은 일반 PC에서도 이루어짐

- PC나 서버 등 TCP/IP를 이용하는 모든 기기에는 라우팅 테이블 존재
- 라우팅 테이블에 기재되지 않은 네트워크로는 IP 패킷을 보낼 수 없음
- PC의 라우팅 테이블은 너무 자세히 경로 정보를 등록하지 않음
	- 직접 접속 경로 정보: IP 주소 설정
	- 디폴트 경로: 기본 게이트웨이의 IP 주소 설정
